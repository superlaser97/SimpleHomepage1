<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage</title>
    <link href="./style.css" rel="stylesheet">
    <script>
        // ---------------------
        // --- CONFIGURATION ---
        // ---------------------

        const icons = {
            "google": "M11.99 2C6.47 2 2 6.47 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95a6.36 6.36 0 00-3.98-3.98V6.07h2.95a8.03 8.03 0 013.98 1.93zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2H4.26zm.8 2h2.95a6.36 6.36 0 003.98 3.98v-2.02h-2.95a8.03 8.03 0 01-3.98-1.96zM12.01 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c.09-.66.15-1.32.15-2s-.06-1.34-.15-2h4.68c-.09.66-.15 1.32-.15 2s.06 1.34.15 2zm.25 5.98v-2.02h2.95a8.03 8.03 0 01-3.98 1.96zM17.07 16h2.95a8.03 8.03 0 00-1.93-3.98H16.07v2.02c.36.01.71.02 1 .02z",
            "bing": "M12.83 12.83L10 16.5V7.5l2.83 3.67 4.51-4.51-2.05-2.05a8 8 0 10-8.12 8.12l2.05 2.05 4.51-4.51z",
            "youtube": "M21.58 7.19c-.23-.86-.91-1.54-1.77-1.77C18.25 5 12 5 12 5s-6.25 0-7.81.42c-.86.23-1.54.91-1.77 1.77C2 8.75 2 12 2 12s0 3.25.42 4.81c.23.86.91 1.54 1.77 1.77C5.75 19 12 19 12 19s6.25 0 7.81-.42c.86-.23-1.54-.91-1.77-1.77C22 15.25 22 12 22 12s0-3.25-.42-4.81zM10 15V9l5.2 3-5.2 3z",
            "reddit": "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1.84 13.21c-1.36 0-2.46-1.1-2.46-2.46s1.1-2.46 2.46-2.46 2.46 1.1 2.46 2.46-1.1 2.46-2.46 2.46zm3.68 0c-1.36 0-2.46-1.1-2.46-2.46s1.1-2.46 2.46-2.46 2.46 1.1 2.46 2.46-1.1 2.46-2.46 2.46zm-5.4-5.06c.26-.26.68-.26.94 0l1.62 1.62c.26.26.26.68 0 .94-.26.26-.68.26-.94 0l-1.62-1.62c-.26-.26-.26-.68 0-.94zm6.16 2.56c-.52 1-1.59 1.68-2.8 1.68s-2.28-.68-2.8-1.68c-.14-.28.04-.63.36-.71.32-.08.66.04.79.36.33.63 1.04 1.03 1.65 1.03s1.32-.4 1.65-1.03c.13-.32.47-.44.79-.36.32.08.5.43.36.71z",
            "github": "M12 2C6.477 2 2 6.477 2 12c0 4.419 2.865 8.166 6.839 9.49.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.343-3.369-1.343-.455-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.004.071 1.532 1.03 1.532 1.03.891 1.53 2.339 1.088 2.91.832.091-.647.349-1.088.635-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.03-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.269 2.75 1.026A9.564 9.564 0 0112 6.82c.85.004 1.705.115 2.504.336 1.909-1.295 2.747-1.026 2.747-1.026.546 1.378.202 2.398.1 2.65.64.7 1.028 1.595 1.028 2.688 0 3.848-2.338 4.695-4.566 4.942.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.578.688.482A10.001 10.001 0 0022 12c0-5.523-4.477-10-10-10z",
            "vercel": "M12 2L2 12l10 10 10-10L12 2z",
            "figma": "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9 18v-6H7V9h2V7a2 2 0 012-2h2v3h-2v2h2v3h-2v3H9z",
            "search": "M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z",
            "edit": "M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",
            "delete": "M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",
            "add": "M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z",
            "copy": "M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z",
            "check": "M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",
            "clipboard": "M19 2h-4.18C14.4 1.15 13.55 0.5 12.5 0.5S10.6 1.15 10.18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h13c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H6V4h2v2h9V4h2v16z"
        };
        
        const SAFE_COLORS = {
            sky: '#0ea5e9', red: '#ef4444', orange: '#f97316', green: '#22c55e', blue: '#3b82f6', indigo: '#6366f1',
            violet: '#8b5cf6', pink: '#ec4899', teal: '#14b8a6', rose: '#f43f5e', gray: '#6b7280', purple: '#a855f7'
        };
        const PREDEFINED_COLORS = Object.keys(SAFE_COLORS);

        const encodedConfig = ``;

        // --- UTILITY FUNCTIONS ---
        function showMessage(title, message, type = 'info') {
            const existingBox = document.getElementById('message-box');
            if (existingBox) existingBox.remove();

            const messageBox = document.createElement('div');
            messageBox.id = 'message-box';
            messageBox.className = 'fixed top-5 left-1/2 -translate-x-1/2 w-full max-w-sm p-4 rounded-lg shadow-lg text-white z-[9999] transition-all duration-300 transform scale-95 opacity-0';
            
            const colors = {
                info: 'bg-sky-500', success: 'bg-green-500',
                warning: 'bg-orange-500', error: 'bg-red-500'
            };
            messageBox.classList.add(colors[type] || colors.info);
            messageBox.innerHTML = `
                <div class="flex items-start">
                    <div class="flex-grow">
                        <h4 class="font-bold">${title}</h4>
                        <p class="text-sm">${message}</p>
                    </div>
                    <button id="message-box-close" class="ml-4 p-1 rounded-full hover:bg-white/20">&times;</button>
                </div>
            `;
            document.body.appendChild(messageBox);
            
            // Trigger animation
            setTimeout(() => {
                messageBox.classList.remove('scale-95', 'opacity-0');
            }, 10);

            const closeMessageBox = () => {
                messageBox.classList.add('opacity-0');
                setTimeout(() => messageBox.remove(), 300);
            };
            document.getElementById('message-box-close').onclick = closeMessageBox;
            setTimeout(closeMessageBox, 5000);
        }

        function showConfirmation(title, message, onConfirm) {
            const existingModal = document.getElementById('confirmation-modal');
            if (existingModal) existingModal.remove();

            const confirmationModal = document.createElement('div');
            confirmationModal.id = 'confirmation-modal';
            confirmationModal.className = 'edit-modal is-active';
            confirmationModal.innerHTML = `
                <div class="edit-modal-content">
                    <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">${title}</h2>
                    <p class="mb-6 text-gray-600 dark:text-gray-300 whitespace-pre-line">${message}</p>
                    <div class="form-actions">
                        <button id="confirm-cancel" class="btn btn-secondary">Cancel</button>
                        <button id="confirm-ok" class="btn btn-primary bg-red-600 hover:bg-red-700">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmationModal);

            const closeModal = () => confirmationModal.remove();
            confirmationModal.addEventListener('click', (e) => { if(e.target === confirmationModal) closeModal(); });
            document.getElementById('confirm-cancel').onclick = closeModal;
            document.getElementById('confirm-ok').onclick = () => {
                onConfirm();
                closeModal();
            };
        }


        function loadConfig() {
            const defaultConfig = {
                pageTitle: "My Homepage",
                notes: [{ title: "Welcome!", content: "This is your new homepage.\nClick the controls that appear on hover to edit or delete items.\n\nTo save your changes, click the copy button in the top right, then paste the copied string into the `encodedConfig` variable in this page's HTML file." }],
                shortcuts: [{ name: "Google", category: "Search", url: "https://www.google.com", icon: "google" }],
                categoryConfig: { "Search": { "color": "sky" }, "General": { "color": "gray" } }
            };

            if (!encodedConfig || encodedConfig.trim() === '') { return defaultConfig; }
            try {
                const decodedJson = atob(encodedConfig);
                const parsedConfig = JSON.parse(decodedJson);
                return { ...defaultConfig, ...parsedConfig };
            } catch (e) {
                console.error("Failed to load or parse config, loading default. Error:", e);
                showMessage("Config Error", "Could not load your saved configuration. The string may be invalid. Loading a default page instead.", "error");
                return defaultConfig;
            }
        }

        let config = loadConfig();
        config.icons = icons; 
        let { pageTitle, notes, shortcuts, categoryConfig } = config;

        // --- RENDER DYNAMIC FAVICON ---
        function renderFavicon() {
            const link = document.createElement('link');
            link.rel = 'icon';
            const svgFavicon = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'><path d='${icons.vercel}'/></svg>`;
            link.href = `data:image/svg+xml,${encodeURIComponent(svgFavicon)}`;
            document.head.appendChild(link);
        }

        // --- RENDER FUNCTIONS ---
        function renderTitle() {
            document.getElementById('page-title').textContent = pageTitle;
            document.title = pageTitle;
        }

        // --- GREETING FUNCTION ---
        function renderGreeter() {
            const greeterContainer = document.getElementById('greeter');
            if (!greeterContainer) return;
            const now = new Date();
            const hour = now.getHours();
            let greeting = 'Welcome!';
            if (hour < 12) { greeting = 'Good morning.'; } 
            else if (hour < 18) { greeting = 'Good afternoon.'; } 
            else { greeting = 'Good evening.'; }
            greeterContainer.textContent = greeting;
        }

        // --- DATE & CLOCK FUNCTIONS ---
        function renderDate() {
            const dateContainer = document.getElementById('date-display');
            if (!dateContainer) return;
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateContainer.textContent = now.toLocaleDateString(undefined, options);
        }

        function renderClock() {
            const clockContainer = document.getElementById('clock');
            if (!clockContainer) return;
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            clockContainer.innerHTML = `${hours}:${minutes}:<span class="opacity-60">${seconds}</span>`;
        }
        
        // --- CREATE UI ELEMENTS ---
        function createItemControls(item, type) {
            const controlsContainer = document.createElement('div');
            controlsContainer.className = 'absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300';

            const editBtn = document.createElement('button');
            editBtn.className = 'p-1 rounded-full bg-gray-300/50 dark:bg-gray-600/50 hover:bg-sky-500/50 dark:hover:bg-sky-400/50 cursor-pointer';
            editBtn.innerHTML = `<svg class="w-4 h-4 text-gray-700 dark:text-gray-200 pointer-events-none" fill="currentColor" viewBox="0 0 24 24"><path d="${icons.edit}"/></svg>`;
            editBtn.onclick = (e) => {
                e.preventDefault(); e.stopPropagation();
                if (type === 'shortcut') showShortcutModal(item);
                else showNoteEditModal(item);
            };

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'p-1 rounded-full bg-gray-300/50 dark:bg-gray-600/50 hover:bg-red-500/50 cursor-pointer';
            deleteBtn.innerHTML = `<svg class="w-4 h-4 text-gray-700 dark:text-gray-200 pointer-events-none" fill="currentColor" viewBox="0 0 24 24"><path d="${icons.delete}"/></svg>`;
            deleteBtn.onclick = (e) => {
                e.preventDefault(); e.stopPropagation();
                showConfirmation('Confirm Deletion', `Are you sure you want to delete this ${type}?`, () => {
                    if (type === 'shortcut') {
                        const index = config.shortcuts.indexOf(item);
                        if (index > -1) config.shortcuts.splice(index, 1);
                        renderShortcuts();
                    } else {
                        const index = config.notes.indexOf(item);
                        if (index > -1) config.notes.splice(index, 1);
                        renderNotes();
                    }
                });
            };
            
            controlsContainer.appendChild(editBtn);
            controlsContainer.appendChild(deleteBtn);
            return controlsContainer;
        }
        
        function createShortcutElement(shortcut) {
            const container = document.createElement('div');
            container.className = 'relative group';

            const a = document.createElement('a');
            a.href = shortcut.url;
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            a.className = 'flex items-center gap-4 p-4 rounded-lg shadow-lg hover:shadow-cyan-500/10 hover:-translate-y-1 transition-all duration-300 text-gray-700 dark:text-gray-200 border border-gray-300/80 dark:border-gray-700/80 ' +
                          'bg-white/50 dark:bg-gray-800/50 hover:bg-gray-200/60 dark:hover:bg-gray-700/80 ' +
                          'style-compact:gap-2 style-compact:p-2 style-compact:text-sm style-compact:bg-white/60 style-compact:dark:bg-gray-800/60';

            if (shortcut.icon && icons[shortcut.icon]) {
                const iconContainer = document.createElement('div');
                iconContainer.className = 'flex-shrink-0 w-6 h-6 style-compact:w-5 style-compact:h-5';
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('viewBox', '0 0 24 24');
                svg.setAttribute('fill', 'currentColor');
                svg.className = 'text-gray-500 dark:text-gray-400 group-hover:text-black dark:group-hover:text-white transition-colors duration-300';
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', icons[shortcut.icon]);
                svg.appendChild(path);
                iconContainer.appendChild(svg);
                a.appendChild(iconContainer);
            }
            const textSpan = document.createElement('span');
            textSpan.textContent = shortcut.name;
            textSpan.className = 'font-semibold style-compact:font-normal';
            a.appendChild(textSpan);

            const previewBox = document.getElementById('link-preview');
            if (previewBox) {
                a.addEventListener('mouseenter', (event) => {
                    previewBox.textContent = shortcut.url;
                    const rect = event.currentTarget.getBoundingClientRect();
                    previewBox.style.top = `${rect.bottom + window.scrollY + 8}px`;
                    previewBox.style.left = `${rect.left + rect.width / 2}px`;
                    previewBox.style.transform = 'translateX(-50%)';
                    previewBox.classList.remove('opacity-0');
                });

                a.addEventListener('mouseleave', () => {
                    previewBox.classList.add('opacity-0');
                });
            }
            
            container.appendChild(a);
            container.appendChild(createItemControls(shortcut, 'shortcut'));
            return container;
        }

        // --- MAIN RENDER FUNCTIONS ---
        function renderShortcuts(query = '') {
            const mainContainer = document.getElementById('shortcuts-container');
            mainContainer.innerHTML = '';
            
            const lowerCaseQuery = query.toLowerCase();
            const filteredShortcuts = config.shortcuts.filter(shortcut => 
                shortcut.name.toLowerCase().includes(lowerCaseQuery) ||
                (shortcut.category && shortcut.category.toLowerCase().includes(lowerCaseQuery))
            );

            if (filteredShortcuts.length === 0) {
                const message = query ? `No results found for "${query}".` : 'No shortcuts configured.';
                mainContainer.innerHTML = `<p class="text-gray-500 dark:text-gray-400 p-4 text-center col-span-full">${message}</p>`;
                return;
            }

            const groupedByCategory = filteredShortcuts.reduce((groups, shortcut) => {
                const category = shortcut.category || 'General';
                if (!groups[category]) groups[category] = [];
                groups[category].push(shortcut);
                return groups;
            }, {});

            let delay = 0;
            for (const category in groupedByCategory) {
                const configData = categoryConfig[category] || { color: 'gray' };
                const colorClass = configData.color;
                const categoryWrapper = document.createElement('div');
                categoryWrapper.className = `p-5 rounded-xl border border-gray-300/80 dark:border-gray-700/80 bg-white/40 dark:bg-gray-800/40 backdrop-blur-sm shadow-2xl transition-all duration-300 style-compact:p-3 style-compact:rounded-lg style-compact:shadow-lg style-compact:bg-white/50 style-compact:dark:bg-gray-800/50`;
                categoryWrapper.style.animationDelay = `${delay}s`;
                delay += 0.1;

                const categoryHeader = document.createElement('div');
                categoryHeader.className = `flex items-center gap-3 mb-4 border-b-2 pb-2`;
                categoryHeader.style.borderColor = (SAFE_COLORS[colorClass] || '#6b7280') + '80';

                const categoryColorDot = document.createElement('div');
                categoryColorDot.className = `w-3 h-3 rounded-full flex-shrink-0`;
                categoryColorDot.style.backgroundColor = SAFE_COLORS[colorClass] || '#6b7280';

                const categoryTitle = document.createElement('h2');
                categoryTitle.textContent = category;
                categoryTitle.className = 'text-xl font-bold text-gray-800 dark:text-gray-200 style-compact:text-lg style-compact:font-semibold';
                
                categoryHeader.appendChild(categoryColorDot);
                categoryHeader.appendChild(categoryTitle);
                categoryWrapper.appendChild(categoryHeader);

                const linksGrid = document.createElement('div');
                linksGrid.className = 'grid grid-cols-1 sm:grid-cols-2 gap-3 style-compact:gap-2';
                groupedByCategory[category].forEach(shortcut => {
                    linksGrid.appendChild(createShortcutElement(shortcut));
                });
                categoryWrapper.appendChild(linksGrid);
                mainContainer.appendChild(categoryWrapper);
            }
        }

        function parseNoteContent(rawContent, isPreview = false) {
             const lines = rawContent.split('\\n');
               let processedLines = [];
               let currentParagraph = [];
               let inList = false;
               const flushParagraph = () => {
                   if (currentParagraph.length > 0) {
                       processedLines.push(`<p class="text-gray-600 dark:text-gray-300 mb-2 style-compact:mb-1 style-compact:text-sm">${currentParagraph.join(' ').trim()}</p>`);
                       currentParagraph = [];
                   }
               };
               const closeList = () => { if (inList) { processedLines.push('</ul>'); inList = false; } };
               lines.forEach(line => {
                   const headerMatch = line.match(/^(#{1,6})(.*?)\1?$/);
                   const listItemMatch = line.match(/^[\-\*]\s(.*)/);
                   if (headerMatch && headerMatch[2].trim() !== '') {
                       flushParagraph(); closeList();
                       const hashes = headerMatch[1];
                       const content = headerMatch[2];
                       const headingLevel = Math.min(hashes.length + 1, 6);
                       let classes = 'font-bold';
                       if (isPreview) { classes += ' text-sm text-gray-500 dark:text-gray-400 mt-2 mb-1 style-compact:text-xs'; } 
                       else { classes += ` text-sky-600 dark:text-sky-300 ${['text-2xl','text-xl','text-lg','text-base'][headingLevel-2] || 'text-base'} mb-2`; }
                       processedLines.push(`<h${headingLevel} class="${classes}">${content.trim()}</h${headingLevel}>`);
                   } else if (listItemMatch) {
                       flushParagraph();
                       if (!inList) { processedLines.push('<ul class="list-disc list-inside space-y-1 pl-2 mb-2 style-compact:text-sm">'); inList = true; }
                       processedLines.push(`<li class="text-gray-600 dark:text-gray-300">${listItemMatch[1].trim()}</li>`);
                   } else if (line.trim() === '') {
                       flushParagraph(); closeList();
                   } else {
                       closeList(); currentParagraph.push(line);
                   }
               });
               flushParagraph(); closeList();
               return processedLines.join('');
       }
        
        function renderNotes(query = '') {
            const notesContainer = document.getElementById('notes-container');
            const maxLines = 6;
            const lowerCaseQuery = query.toLowerCase();
            const filteredNotes = config.notes.filter(note => query === '' || (note.title && note.title.toLowerCase().includes(lowerCaseQuery)) || note.content.toLowerCase().includes(lowerCaseQuery) );
            if (filteredNotes.length === 0) {
                const message = query ? `No notes found for "${query}".` : 'No notes available.';
                notesContainer.innerHTML = `<p class="text-gray-500 dark:text-gray-400 p-4 text-center col-span-full">${message}</p>`;
                return;
            }
            notesContainer.innerHTML = '';
            let delay = 0;
            filteredNotes.forEach(note => {
                const noteCard = document.createElement('div');
                noteCard.className = 'relative group p-5 rounded-xl border border-gray-300/80 dark:border-gray-700/80 bg-white/40 dark:bg-gray-800/40 backdrop-blur-sm shadow-2xl flex flex-col transition-all duration-300 style-compact:p-3 style-compact:rounded-lg style-compact:shadow-lg style-compact:bg-white/50 style-compact:dark:bg-gray-800/50';
                noteCard.style.animationDelay = `${delay}s`;
                delay += 0.1;
                if (note.title) {
                    const titleElement = document.createElement('h3');
                    titleElement.className = 'text-lg font-bold text-sky-600 dark:text-sky-300 mb-2 style-compact:text-base style-compact:mb-1';
                    titleElement.textContent = note.title;
                    noteCard.appendChild(titleElement);
                }
                const contentElement = document.createElement('div');
                contentElement.className = 'text-gray-600 dark:text-gray-300 whitespace-pre-wrap style-compact:text-sm';
                noteCard.appendChild(contentElement);
                const lines = note.content.split('\\n');
                const isTruncated = lines.length > maxLines;
                const previewContent = isTruncated ? lines.slice(0, maxLines).join('\\n') + '\\n...' : note.content;
                contentElement.innerHTML = parseNoteContent(previewContent, true);
                noteCard.appendChild(createItemControls(note, 'note'));
                if (isTruncated) {
                    const readMore = document.createElement('span');
                    readMore.textContent = 'Read more';
                    readMore.className = 'text-sky-600 dark:text-sky-400 hover:text-sky-500 dark:hover:text-sky-300 font-semibold mt-auto pt-2 cursor-pointer style-compact:text-xs style-compact:pt-1';
                    noteCard.appendChild(readMore);
                }
                noteCard.classList.add('cursor-pointer', 'hover:border-sky-500/50', 'dark:hover:border-sky-500/50', 'hover:-translate-y-1');
                noteCard.addEventListener('click', (e) => {
                    if (e.target.closest('button')) return;
                    showNoteModal(note.title, parseNoteContent(note.content, false), note.content)
                });
                notesContainer.appendChild(noteCard);
            });
        }
        
        // --- MODAL & EDITING LOGIC ---
        function showNoteModal(title, htmlContent, rawContent) {
            const modal = document.getElementById('note-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            modalTitle.textContent = title || 'Note';
            modalTitle.style.display = title ? 'block' : 'none';
            modalBody.innerHTML = htmlContent;
            modal.classList.add('is-active');
            document.body.style.overflow = 'hidden';
            const copyBtn = document.getElementById('modal-copy-btn');
            copyBtn.dataset.rawContent = rawContent;
        }

        function hideNoteModal() {
            const modal = document.getElementById('note-modal');
            modal.classList.remove('is-active');
            document.body.style.overflow = '';
        }

        function setupModal() {
            const modal = document.getElementById('note-modal');
            const closeBtn = document.getElementById('modal-close-btn');
            const copyBtn = document.getElementById('modal-copy-btn');
            const copyBtnText = document.getElementById('copy-btn-text');
            const copyBtnIcon = document.getElementById('copy-btn-icon');
            const copyBtnSuccessIcon = document.getElementById('copy-btn-success-icon');

            if (!modal || !closeBtn || !copyBtn) return;
            
            closeBtn.addEventListener('click', hideNoteModal);
            copyBtn.addEventListener('click', (e) => {
                if (copyBtnText.textContent === 'Copied!') return;
                const rawContent = e.currentTarget.dataset.rawContent;
                navigator.clipboard.writeText(rawContent).then(() => {
                    copyBtnText.textContent = 'Copied!';
                    copyBtnIcon.classList.add('hidden');
                    copyBtnSuccessIcon.classList.remove('hidden');
                    setTimeout(() => {
                        copyBtnText.textContent = 'Copy';
                        copyBtnIcon.classList.remove('hidden');
                        copyBtnSuccessIcon.classList.add('hidden');
                    }, 2000);
                }).catch(err => console.error('Failed to copy text: ', err));
            });
            modal.addEventListener('click', (event) => { if (event.target === modal) hideNoteModal(); });
        }
        
        let editingShortcut = null;
        let editingCategoryName = null;
        
        function renderCategorySelector(container, hiddenInput, selectedCategory = '') {
            container.innerHTML = ''; 
            const shortcutCategories = config.shortcuts.map(s => s.category);
            const configuredCategories = Object.keys(config.categoryConfig);
            const allCategories = [...new Set(['General', ...shortcutCategories, ...configuredCategories])].sort();
            
            allCategories.forEach(category => {
                const tagWrapper = document.createElement('div');
                tagWrapper.className = 'category-tag-wrapper';

                const tag = document.createElement('button');
                tag.type = 'button';
                tag.className = 'category-tag-btn';
                tag.textContent = category;
                tag.dataset.category = category;
                if (category === selectedCategory) { tag.classList.add('active'); }
                tagWrapper.appendChild(tag);
                
                if (category !== 'General') {
                    const controls = document.createElement('div');
                    controls.className = 'category-tag-controls';
                    const editBtn = document.createElement('button');
                    editBtn.type = 'button';
                    editBtn.className = 'category-edit-btn';
                    editBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="${icons.edit}"/></svg>`;
                    editBtn.onclick = (e) => { e.stopPropagation(); showCategoryModal(category); };
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.type = 'button';
                    deleteBtn.className = 'category-delete-btn';
                    deleteBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="${icons.delete}"/></svg>`;
                    deleteBtn.onclick = (e) => { e.stopPropagation(); deleteCategory(category); };

                    controls.appendChild(editBtn);
                    controls.appendChild(deleteBtn);
                    tagWrapper.appendChild(controls);
                }
                container.appendChild(tagWrapper);
            });

            hiddenInput.value = selectedCategory;

            const addCatButton = document.createElement('button');
            addCatButton.type = 'button';
            addCatButton.className = 'category-tag-btn add-new-btn';
            addCatButton.innerHTML = `<svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="${icons.add}"/></svg> New`;
            addCatButton.onclick = () => showCategoryModal();
            container.appendChild(addCatButton);
        }

        function deleteCategory(categoryToDelete) {
            showConfirmation('Delete Category', `Are you sure you want to delete the "${categoryToDelete}" category?\nAll shortcuts in this category will be moved to "General".`, () => {
                config.shortcuts.forEach(shortcut => {
                    if (shortcut.category === categoryToDelete) { shortcut.category = 'General'; }
                });
                delete config.categoryConfig[categoryToDelete];
                const categoryContainer = document.getElementById('shortcut-category-selector');
                const categoryInput = document.getElementById('shortcut-category-input');
                const newSelectedCategory = categoryInput.value === categoryToDelete ? 'General' : categoryInput.value;
                renderCategorySelector(categoryContainer, categoryInput, newSelectedCategory);
                renderShortcuts();
            });
        }

        function renderIconSelector(container, hiddenInput, selectedIcon = '') {
            container.innerHTML = '';
            const iconNames = Object.keys(config.icons).sort();
            const noneTag = document.createElement('button');
            noneTag.type = 'button';
            noneTag.className = 'icon-tag-btn none-btn';
            noneTag.textContent = 'None';
            noneTag.dataset.icon = '';
            if (selectedIcon === '' || !selectedIcon) { noneTag.classList.add('active'); }
            container.appendChild(noneTag);
            iconNames.forEach(iconName => {
                const tag = document.createElement('button');
                tag.type = 'button';
                tag.className = 'icon-tag-btn';
                tag.dataset.icon = iconName;
                tag.title = iconName;
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('viewBox', '0 0 24 24');
                svg.setAttribute('fill', 'currentColor');
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', config.icons[iconName]);
                svg.appendChild(path);
                tag.appendChild(svg);
                if (iconName === selectedIcon) { tag.classList.add('active'); }
                container.appendChild(tag);
            });
            hiddenInput.value = selectedIcon || '';
        }

        function showCategoryModal(categoryName = null) {
            editingCategoryName = categoryName;
            const modal = document.getElementById('add-category-modal');
            const form = document.getElementById('add-category-form');
            const title = modal.querySelector('h2');
            const saveButton = modal.querySelector('button[type="submit"]');
            const nameInput = document.getElementById('new-category-name-input');
            const colorContainer = document.getElementById('new-category-color-selector');
            const colorInput = document.getElementById('new-category-color-input');
            
            form.reset();
            
            if (categoryName) {
                title.textContent = 'Edit Category';
                saveButton.textContent = 'Update Category';
                nameInput.value = categoryName;
                const currentColor = config.categoryConfig[categoryName]?.color || PREDEFINED_COLORS[0];
                renderColorSelector(colorContainer, colorInput, currentColor);
            } else {
                title.textContent = 'Add New Category';
                saveButton.textContent = 'Save Category';
                renderColorSelector(colorContainer, colorInput, PREDEFINED_COLORS[0]);
            }
            modal.classList.add('is-active');
        }

        function hideCategoryModal() {
            document.getElementById('add-category-modal').classList.remove('is-active');
            editingCategoryName = null;
        }
        
        function renderColorSelector(container, hiddenInput, selectedColor) {
            container.innerHTML = '';
            PREDEFINED_COLORS.forEach(colorName => {
                const tag = document.createElement('button');
                tag.type = 'button';
                tag.className = `color-tag-btn`;
                tag.style.backgroundColor = SAFE_COLORS[colorName];
                tag.dataset.color = colorName;
                tag.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="${config.icons.check}"/></svg>`;
                if (colorName === selectedColor) { tag.classList.add('active'); }
                container.appendChild(tag);
            });
            hiddenInput.value = selectedColor;
        }

        function showShortcutModal(shortcut = null) {
            editingShortcut = shortcut;
            const modal = document.getElementById('edit-shortcut-modal');
            const title = document.getElementById('edit-shortcut-modal-title');
            const categoryContainer = document.getElementById('shortcut-category-selector');
            const categoryInput = document.getElementById('shortcut-category-input');
            const iconContainer = document.getElementById('shortcut-icon-selector');
            const iconInput = document.getElementById('shortcut-icon-input');
            if (shortcut) {
                title.textContent = 'Edit Shortcut';
                document.getElementById('shortcut-name-input').value = shortcut.name;
                document.getElementById('shortcut-url-input').value = shortcut.url;
                renderCategorySelector(categoryContainer, categoryInput, shortcut.category);
                renderIconSelector(iconContainer, iconInput, shortcut.icon || '');
            } else {
                title.textContent = 'Add Shortcut';
                document.getElementById('edit-shortcut-form').reset();
                renderCategorySelector(categoryContainer, categoryInput, 'General');
                renderIconSelector(iconContainer, iconInput, '');
            }
            modal.classList.add('is-active');
            document.body.style.overflow = 'hidden';
        }

        function hideShortcutModal() {
            const modal = document.getElementById('edit-shortcut-modal');
            modal.classList.remove('is-active');
            document.body.style.overflow = '';
            editingShortcut = null;
        }

        let editingNote = null;
        function showNoteEditModal(note = null) {
            editingNote = note;
            const modal = document.getElementById('edit-note-modal');
            const title = document.getElementById('edit-note-modal-title');
            if (note) {
                title.textContent = 'Edit Note';
                document.getElementById('note-title-input').value = note.title || '';
                document.getElementById('note-content-input').value = note.content.replace(/\\n/g, '\n');
            } else {
                title.textContent = 'Add Note';
                document.getElementById('edit-note-form').reset();
            }
            modal.classList.add('is-active');
            document.body.style.overflow = 'hidden';
        }

        function hideNoteEditModal() {
            const modal = document.getElementById('edit-note-modal');
            modal.classList.remove('is-active');
            document.body.style.overflow = '';
            editingNote = null;
        }

        function setupEditing() {
            document.getElementById('edit-shortcut-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const updatedShortcut = {
                    name: document.getElementById('shortcut-name-input').value,
                    url: document.getElementById('shortcut-url-input').value,
                    category: document.getElementById('shortcut-category-input').value,
                    icon: document.getElementById('shortcut-icon-input').value
                };
                if (editingShortcut) { Object.assign(editingShortcut, updatedShortcut); } 
                else { config.shortcuts.push(updatedShortcut); }
                hideShortcutModal();
                renderShortcuts(document.getElementById('search-input').value);
            });
            document.getElementById('edit-shortcut-modal').addEventListener('click', (e) => { if(e.target === e.currentTarget) hideShortcutModal() });
            document.getElementById('shortcut-modal-cancel').addEventListener('click', hideShortcutModal);
            
            document.getElementById('shortcut-category-selector').addEventListener('click', (e) => {
                const clickedTag = e.target.closest('.category-tag-btn');
                if (!clickedTag || e.target.closest('.category-tag-controls')) return;
                document.getElementById('shortcut-category-input').value = clickedTag.dataset.category;
                const container = clickedTag.closest('.category-selector-container');
                const currentActive = container.querySelector('.category-tag-btn.active');
                if (currentActive) { currentActive.classList.remove('active'); }
                clickedTag.classList.add('active');
            });

            document.getElementById('shortcut-icon-selector').addEventListener('click', (e) => {
                const clickedTag = e.target.closest('.icon-tag-btn');
                if (!clickedTag) return;
                document.getElementById('shortcut-icon-input').value = clickedTag.dataset.icon;
                const container = clickedTag.parentElement;
                const currentActive = container.querySelector('.icon-tag-btn.active');
                if (currentActive) { currentActive.classList.remove('active'); }
                clickedTag.classList.add('active');
            });

            document.getElementById('add-category-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const newName = document.getElementById('new-category-name-input').value.trim();
                const newColor = document.getElementById('new-category-color-input').value;
                if (!newName) {
                    showMessage("Validation Error", "Category name cannot be empty.", "warning");
                    return;
                }

                if (editingCategoryName) {
                    config.categoryConfig[editingCategoryName].color = newColor;
                    if (editingCategoryName !== newName) {
                        config.shortcuts.forEach(sc => {
                            if (sc.category === editingCategoryName) { sc.category = newName; }
                        });
                        config.categoryConfig[newName] = config.categoryConfig[editingCategoryName];
                        delete config.categoryConfig[editingCategoryName];
                    }
                } else {
                    config.categoryConfig[newName] = { color: newColor };
                }
                
                hideCategoryModal();
                const categoryContainer = document.getElementById('shortcut-category-selector');
                const categoryInput = document.getElementById('shortcut-category-input');
                renderCategorySelector(categoryContainer, categoryInput, newName);
                renderShortcuts();
            });
            document.getElementById('new-category-color-selector').addEventListener('click', (e) => {
                const clickedTag = e.target.closest('.color-tag-btn');
                if (!clickedTag) return;
                document.getElementById('new-category-color-input').value = clickedTag.dataset.color;
                const container = clickedTag.parentElement;
                const currentActive = container.querySelector('.color-tag-btn.active');
                if (currentActive) { currentActive.classList.remove('active'); }
                clickedTag.classList.add('active');
            });
            document.getElementById('category-modal-cancel').addEventListener('click', hideCategoryModal);


            document.getElementById('edit-note-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const updatedNote = {
                    title: document.getElementById('note-title-input').value,
                    content: document.getElementById('note-content-input').value.replace(/\n/g, '\\n')
                };
                if (!updatedNote.title) delete updatedNote.title;
                if (editingNote) { Object.assign(editingNote, updatedNote); } 
                else { config.notes.push(updatedNote); }
                hideNoteEditModal();
                renderNotes(document.getElementById('search-input').value);
            });
            document.getElementById('edit-note-modal').addEventListener('click', (e) => { if(e.target === e.currentTarget) hideNoteEditModal() });
            document.getElementById('note-modal-cancel').addEventListener('click', hideNoteEditModal);
            
            document.getElementById('add-shortcut-btn').addEventListener('click', () => showShortcutModal());
            document.getElementById('add-note-btn').addEventListener('click', () => showNoteEditModal());
        }

        // --- SETUP FUNCTIONS ---
        function setupAddButtonIcons() {
            const addShortcutBtn = document.getElementById('add-shortcut-btn');
            const addNoteBtn = document.getElementById('add-note-btn');
            const createIcon = (iconPath) => {
                const svgNS = 'http://www.w3.org/2000/svg';
                const svg = document.createElementNS(svgNS, 'svg');
                svg.setAttribute('class', 'w-4 h-4 text-sky-600 dark:text-sky-300');
                svg.setAttribute('fill', 'currentColor');
                svg.setAttribute('viewBox', '0 0 24 24');
                const path = document.createElementNS(svgNS, 'path');
                path.setAttribute('d', iconPath);
                svg.appendChild(path);
                return svg;
            }
            const addIcon = createIcon(icons.add);
            addShortcutBtn.prepend(addIcon.cloneNode(true));
            addNoteBtn.prepend(addIcon.cloneNode(true));
        }

        function setupSearch() {
            const searchInput = document.getElementById('search-input');
            const searchBox = document.getElementById('search-box');
            if (!searchInput) return;
            searchInput.addEventListener('keyup', (e) => {
                const query = e.target.value;
                const isShortcutsActive = document.getElementById('tab-shortcuts').classList.contains('active-tab');
                if (isShortcutsActive) { renderShortcuts(query); } 
                else { renderNotes(query); }
            });
            searchInput.addEventListener('focus', () => searchBox.classList.add('border-sky-500'));
            searchInput.addEventListener('blur', () => searchBox.classList.remove('border-sky-500'));
        }

        function setupTabs() {
            const shortcutsTab = document.getElementById('tab-shortcuts');
            const notesTab = document.getElementById('tab-notes');
            const shortcutsContainer = document.getElementById('shortcuts-container');
            const notesContainer = document.getElementById('notes-container');
            const searchInput = document.getElementById('search-input');
            const addShortcutBtn = document.getElementById('add-shortcut-btn');
            const addNoteBtn = document.getElementById('add-note-btn');
            function updateTabState(activeTab) {
                const query = searchInput.value;
                if (activeTab === 'shortcuts') {
                    shortcutsTab.classList.add('active-tab'); notesTab.classList.remove('active-tab');
                    shortcutsContainer.classList.remove('hidden'); notesContainer.classList.add('hidden');
                    addShortcutBtn.classList.remove('hidden'); addNoteBtn.classList.add('hidden');
                    searchInput.placeholder = "Search shortcuts... (Press '/' to focus)";
                    renderShortcuts(query);
                } else {
                    notesTab.classList.add('active-tab'); shortcutsTab.classList.remove('active-tab');
                    notesContainer.classList.remove('hidden'); shortcutsContainer.classList.add('hidden');
                    addNoteBtn.classList.remove('hidden'); addShortcutBtn.classList.add('hidden');
                    searchInput.placeholder = "Search notes... (Press '/' to focus)";
                    renderNotes(query);
                }
            }
            updateTabState('shortcuts');
            shortcutsTab.addEventListener('click', () => updateTabState('shortcuts'));
            notesTab.addEventListener('click', () => updateTabState('notes'));
        }

        function setupThemeSwitcher() {
            const themeBtn = document.getElementById('theme-switcher');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const applyTheme = (isDark) => {
                document.documentElement.classList.toggle('dark', isDark);
                sunIcon.classList.toggle('hidden', !isDark);
                moonIcon.classList.toggle('hidden', isDark);
            };
            themeBtn.addEventListener('click', () => {
                const isDarkMode = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                applyTheme(isDarkMode);
            });
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            applyTheme(savedTheme === 'dark' || (!savedTheme && systemPrefersDark));
        }

        function setupDisplayStyleSwitcher() {
            const styleBtn = document.getElementById('style-switcher');
            const styleText = document.getElementById('style-text');
            const container = document.querySelector('.container');
            const applyDisplayStyle = (isCompact) => {
                container.classList.toggle('style-compact', isCompact);
                styleText.textContent = isCompact ? 'Comfortable' : 'Compact';
                const currentQuery = document.getElementById('search-input').value;
                renderShortcuts(currentQuery);
                renderNotes(currentQuery);
            };
            styleBtn.addEventListener('click', () => {
                const isCompact = container.classList.toggle('style-compact');
                localStorage.setItem('displayStyle', isCompact ? 'compact' : 'comfortable');
                applyDisplayStyle(isCompact);
            });
            const savedDisplayStyle = localStorage.getItem('displayStyle');
            applyDisplayStyle(savedDisplayStyle === 'compact');
        }

        function setupConfigCopy() {
            const copyBtn = document.getElementById('copy-config-btn');
            const copyWrapper = document.getElementById('copy-config-wrapper');
            const copyIcon = document.getElementById('config-copy-icon');
            const successIcon = document.getElementById('config-copy-success-icon');

            // Create a popover element for instructions
            const popover = document.createElement('div');
            popover.className = 'absolute top-full mt-2 right-0 w-80 p-4 rounded-xl bg-gray-900/90 dark:bg-gray-900/80 backdrop-blur-sm border border-gray-700 text-white text-sm font-normal shadow-lg z-50 opacity-0 pointer-events-none transition-all duration-300 transform scale-95';
            popover.innerHTML = `
                <h4 class="font-bold mb-2 text-sky-400 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                    Configuration Copied!
                </h4>
                <p class="text-gray-300 leading-relaxed">To save your layout, open this page's <code class="bg-gray-700 text-sky-300 rounded px-1 py-0.5 text-xs">.html</code> file and paste the copied string into the <code class="bg-gray-700 text-sky-300 rounded px-1 py-0.5 text-xs">encodedConfig</code> variable, then save the file.</p>
            `;
            if (copyWrapper) {
                copyWrapper.appendChild(popover);
            }
            
            copyBtn.addEventListener('click', () => {
                config.pageTitle = document.getElementById('page-title').textContent;
                const configToSave = {
                    pageTitle: config.pageTitle,
                    notes: config.notes,
                    shortcuts: config.shortcuts,
                    categoryConfig: config.categoryConfig,
                };
                const jsonString = JSON.stringify(configToSave);
                const base64String = btoa(unescape(encodeURIComponent(jsonString)));
                navigator.clipboard.writeText(base64String).then(() => {
                    copyIcon.classList.add('hidden');
                    successIcon.classList.remove('hidden');
                    
                    popover.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');
                    popover.classList.add('scale-100');

                    setTimeout(() => {
                        copyIcon.classList.remove('hidden');
                        successIcon.classList.add('hidden');
                        popover.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
                        popover.classList.remove('scale-100');
                    }, 7000); // Keep it visible for 7 seconds
                }).catch(err => {
                    showMessage('Copy Failed', 'Could not copy configuration to clipboard.', 'error');
                    console.error('Failed to copy config: ', err);
                });
            });
        }


        // --- INITIALIZATION ---
        window.onload = function() {
            renderTitle();
            renderFavicon();
            renderGreeter();
            renderDate();
            renderClock();
            setInterval(renderClock, 1000);
            setupAddButtonIcons();
            setupThemeSwitcher();
            setupDisplayStyleSwitcher();
            setupSearch();
            setupTabs();
            setupModal();
            setupEditing();
            setupConfigCopy();
            window.addEventListener('keydown', (event) => {
                if (event.key === '/' && document.activeElement.tagName.toLowerCase() !== 'input' && document.activeElement.tagName.toLowerCase() !== 'textarea') {
                    event.preventDefault();
                    document.getElementById('search-input').focus();
                }
                if (event.key === 'Escape') {
                    if (document.getElementById('note-modal').classList.contains('is-active')) hideNoteModal();
                    if (document.getElementById('edit-shortcut-modal').classList.contains('is-active')) hideShortcutModal();
                    if (document.getElementById('edit-note-modal').classList.contains('is-active')) hideNoteEditModal();
                    if (document.getElementById('add-category-modal').classList.contains('is-active')) hideCategoryModal();
                }
            });
        };
    </script>
</head>
<body class="bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-white transition-colors duration-300">
    
    <div class="fixed top-4 right-4 flex space-x-2 z-50">
        <div id="copy-config-wrapper" class="relative">
            <button id="copy-config-btn" class="p-2 rounded-full bg-gray-500/20 hover:bg-gray-500/40 backdrop-blur-sm transition-colors cursor-pointer" title="Copy configuration to save changes" aria-label="Copy Configuration to Clipboard">
                <svg id="config-copy-icon" class="w-6 h-6 text-gray-200" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>
                <svg id="config-copy-success-icon" class="w-6 h-6 text-green-500 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
            </button>
        </div>
        <button id="theme-switcher" class="p-2 rounded-full bg-gray-500/20 hover:bg-gray-500/40 backdrop-blur-sm transition-colors cursor-pointer" aria-label="Toggle theme"><svg id="sun-icon" class="w-6 h-6 text-yellow-500 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><svg id="moon-icon" class="w-6 h-6 text-gray-200 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg></button>
        <button id="style-switcher" class="p-2 rounded-full bg-gray-500/20 hover:bg-gray-500/40 backdrop-blur-sm transition-colors cursor-pointer" aria-label="Toggle display style"><span id="style-text" class="text-sm font-semibold">Compact</span></button>
    </div>

    <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-white/10 via-white/0 to-indigo-100/20 dark:from-gray-900 dark:via-gray-900 dark:to-indigo-900/40 -z-10"></div>
    
    <div class="container mx-auto p-4 sm:p-6 lg:p-8 transition-all duration-300 style-compact:p-2 style-compact:sm:p-4 style-compact:lg:p-6">
        <div class="mb-8 style-compact:mb-4"><div class="flex items-baseline gap-4"><h1 id="page-title" class="text-4xl font-bold text-left fade-in style-compact:text-3xl"></h1><div id="clock" class="text-xl font-mono text-gray-500 dark:text-gray-400 style-compact:text-lg"></div></div><p id="greeter" class="text-gray-500 dark:text-gray-400 fade-in"></p><p id="date-display" class="text-gray-500 dark:text-gray-400 fade-in"></p></div>
        <div class="mb-6 style-compact:mb-4"><div id="search-box" class="relative flex items-center p-1 rounded-xl border border-gray-300/80 dark:border-gray-700/80 bg-white/40 dark:bg-gray-800/40 backdrop-blur-sm shadow-lg transition-colors"><div class="w-10 h-10 flex items-center justify-center flex-shrink-0"><svg class="w-6 h-6 text-gray-400 dark:text-gray-500" fill="currentColor" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></div><input id="search-input" type="text" placeholder="Search shortcuts... (Press '/' to focus)" class="w-full bg-transparent p-2 text-gray-800 dark:text-gray-200 focus:outline-none"></div></div>
        <div class="mb-4 flex items-center border-b border-gray-300/80 dark:border-gray-700/80"><button id="tab-shortcuts" class="tab-button px-4 py-2 text-sm font-semibold border-b-2 border-transparent transition-colors duration-300 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200">Shortcuts</button><button id="tab-notes" class="tab-button px-4 py-2 text-sm font-semibold border-b-2 border-transparent transition-colors duration-300 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200">Notes</button><div class="ml-auto"><button id="add-shortcut-btn" class="hidden cursor-pointer flex items-center gap-2 px-3 py-1.5 rounded-lg bg-sky-500/10 hover:bg-sky-500/20 dark:bg-sky-400/10 dark:hover:bg-sky-400/20 transition-colors"><span class="text-sm font-semibold text-sky-700 dark:text-sky-200">Add Shortcut</span></button><button id="add-note-btn" class="hidden cursor-pointer flex items-center gap-2 px-3 py-1.5 rounded-lg bg-sky-500/10 hover:bg-sky-500/20 dark:bg-sky-400/10 dark:hover:bg-sky-400/20 transition-colors"><span class="text-sm font-semibold text-sky-700 dark:text-sky-200">Add Note</span></button></div></div>
        <div id="shortcuts-container" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3 mb-6 style-compact:gap-2 style-compact:mb-4"></div>
        <div id="notes-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 style-compact:gap-2"></div>
    </div>

    <div id="note-modal" class="edit-modal"><div class="edit-modal-content"><button id="modal-close-btn" class="absolute top-4 right-4 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white text-3xl leading-none z-10 cursor-pointer">×</button><div class="flex-grow overflow-y-auto" style="scrollbar-width: thin; scrollbar-color: #6b7280 transparent;"><div class="p-8"><h2 id="modal-title" class="text-2xl font-bold mb-4 text-gray-900 dark:text-white"></h2><div id="modal-body" class="text-gray-700 dark:text-gray-200 whitespace-pre-wrap"></div></div></div><div class="flex-shrink-0 pt-4 pb-6 px-8 border-t border-gray-200 dark:border-gray-700 flex justify-end"><button id="modal-copy-btn" class="flex items-center gap-2 px-4 py-2 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors cursor-pointer" aria-label="Copy content"><span id="copy-btn-text" class="text-sm font-medium text-gray-700 dark:text-gray-200">Copy</span><svg id="copy-btn-icon" class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><svg id="copy-btn-success-icon" class="w-5 h-5 text-green-500 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button></div></div></div>
    <div id="edit-shortcut-modal" class="edit-modal"><div class="edit-modal-content"><h2 id="edit-shortcut-modal-title" class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100"></h2><form id="edit-shortcut-form"><div class="form-field"><label for="shortcut-name-input">Name</label><input id="shortcut-name-input" type="text" required></div><div class="form-field"><label for="shortcut-url-input">URL</label><input id="shortcut-url-input" type="url" required></div><div class="form-field"><label>Category</label><div id="shortcut-category-selector" class="category-selector-container"></div><input id="shortcut-category-input" type="hidden" required></div><div class="form-field"><label>Icon</label><div id="shortcut-icon-selector" class="icon-selector-container"></div><input id="shortcut-icon-input" type="hidden"></div><div class="form-actions"><button type="button" id="shortcut-modal-cancel" class="btn btn-secondary">Cancel</button><button type="submit" class="btn btn-primary">Save</button></div></form></div></div>
    <div id="edit-note-modal" class="edit-modal"><div class="edit-modal-content"><h2 id="edit-note-modal-title" class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100"></h2><form id="edit-note-form"><div class="form-field"><label for="note-title-input">Title (Optional)</label><input id="note-title-input" type="text"></div><div class="form-field"><label for="note-content-input">Content</label><textarea id="note-content-input" required></textarea></div><div class="form-actions"><button type="button" id="note-modal-cancel" class="btn btn-secondary">Cancel</button><button type="submit" class="btn btn-primary">Save</button></div></form></div></div>
    
    <div id="add-category-modal" class="edit-modal"><div class="edit-modal-content"><h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100">Add New Category</h2><form id="add-category-form"><div class="form-field"><label for="new-category-name-input">Category Name</label><input id="new-category-name-input" type="text" required></div><div class="form-field"><label>Color</label><div id="new-category-color-selector" class="color-selector-container"></div><input id="new-category-color-input" type="hidden" required></div><div class="form-actions"><button type="button" id="category-modal-cancel" class="btn btn-secondary">Cancel</button><button type="submit" class="btn btn-primary">Save Category</button></div></form></div></div>

    <div id="link-preview" class="fixed pointer-events-none z-50 rounded-lg bg-gray-800 px-3 py-1.5 text-sm font-medium text-white shadow-lg transition-opacity duration-200 opacity-0" role="tooltip"></div>
</body>
</html>
